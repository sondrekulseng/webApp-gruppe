<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Bestill</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="js/script.js"></script>
</head>
<body onload="hentStrekninger()">

    <!-- Nav bar-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-bottom: 2%;">
            <a style="margin-left:26.5%;" class="nav-link active" href="index.html">Ny bestilling</a>
            <a href="index.html">
                <div class="logo">
                    <img src="tomCruise.png" href="index.html" style="width: 25%; height: 25%;">
                </div>
            </a>
            <a class="nav-link" href="bestillinger.html">Mine bestillinger</a>
    </nav>
        
    <!-- Bestilling skjema -->
    <form class="form-group hovedboks" id="frmBestill">
        <center>
            <h2>Bestill reise</h2>
            <!-- Velg reise-->
            <input type="radio" name="tur" id="enVei" value=0 onclick="endreSkjema(this.value)" checked />
            <label for="enVei">En Vei</label>
            <input type="radio" name="tur" id="retur" value=1 onclick="endreSkjema(this.value)" />
            <label for="retur">Tur/Retur</label>
        </center>
        <br>
        <!-- Velg strekning -->
        <h4>Velg strekning</h4>
        <select id="velgStrekning" class="form-control"></select>
        <br>
        <!-- Velg avreisedato -->
        <h4>Avreise</h4>
        <input type="date" class="form-control" id="velgDato" onchange="validateRetur(this.value)" required />
        <!-- Hjemreise dato -->
        <div id="divRetur">
            <h4>Hjemreise</h4>
            <input type="date" class="form-control" id="velgReturDato" disabled />
        </div>
        <!-- Kundeinfo -->
        <br>
        <h4>Kunde info</h4>
        <input type="text" class="form-control" id="inpFornavn"  placeholder="Fornavn" required />
        <input type="text" class="form-control" id="inpEtternavn" placeholder="Etternavn" required />
        <input type="email" class="form-control" id="inpEpost" placeholder="Epost" required />
        <input type="tel" class="form-control" id="inpTelefon" pattern="[4,9]{1}[0-9]{7}" placeholder="Telefon" required />
        <br>
        <center><button type="submit" class="btn btn-primary">Send bestilling</button></center>
    </form>

    <!-- Modal for kvittering -->
    <div class="modal fade" id="modalContainer" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#modalContainer').modal('hide');">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalBody"></div>
                <div class="modal-footer" id="modalFooter">
                    <button type="button" class="btn btn-secondary" onclick="$('#modalContainer').modal('hide');">Lukk</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // dato frem i tid
        $("#velgDato").attr("min", currentDate());

        // form submit
        document.getElementById("frmBestill").onsubmit = function (evt) {
            evt.preventDefault();

            const bestilling = {
                fornavn: $("#inpFornavn").val(),
                etternavn: $("#inpEtternavn").val(),
                epost: $("#inpEpost").val(),
                telefon: $("#inpTelefon").val(),
                avreiseDato: $("#velgDato").val(),
                returDato: $("#velgReturDato").val(),
                strekningID: document.getElementById("velgStrekning").selectedIndex
            };

            $.post("Bestilling/lagre", bestilling, function () {
                $("#inpFornavn").val("");
                $("#inpEtternavn").val("");
                $("#inpEpost").val("");
                $("#inpTelefon").val("");
                $("#velgDato").val("");
                $("#velgReturDato").val("");
            }).done(function () {
                // ingen feil, vis kvittering
                visKvittering();
            }).fail(function () {
                // feil
                alert("Det har skjedd en feil");
            });
        }
    </script>
</body>
</html>